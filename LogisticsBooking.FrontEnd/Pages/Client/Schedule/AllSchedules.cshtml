@page "{id}"
@using LogisticsBooking.FrontEnd.DataServices.Models
@model LogisticsBooking.FrontEnd.Pages.Client.Schedule.AllSchedules

<head>


    <style>
                td.details-control {
                    text-align:center;
                    color:forestgreen;
            cursor: pointer;
        }
        tr.shown td.details-control {
            text-align:center; 
            color:red;
        }
        
        
       .container-fluid {
       width: 60%;
       }
       
       #example_filter {
       display: flex;
       justify-content: flex-end;
       }
       
        
    </style>

</head>


<div class="container">


    <table style="background-color: white;" class="table table-hover" width="60%">
        <thead>
        <tr>
            <th scope="col">Navn</th>
            <th scope="col">Aktiv</th>
        </tr>
        </thead>
        <tbody>
        
            @foreach (var schedule in @Model.MasterSchedulesStandardViewModel.MasterScheduleStandardViewModels)
            {
                
                <tr>
                    <td>@schedule.Name</td>
                    
                    <td>
                       
                             <form id="_@schedule.MasterScheduleStandardId" method="post" asp-page-handler="ChangeActive">
                            <input type="hidden" asp-for="@schedule.MasterScheduleStandardId" name="id"/>
                            @if (schedule.IsActive)
                            {
                                <input checked="checked"  type="radio" name="isActive"/>
                            }
                            else
                            {
                                <input type="Radio"  name="isActive"/>
                            }
                           </form>
                       
                        


                    </td>
                </tr>
            
            }
      
        


        </tbody>
    </table>
<div id="spin" class="d-none justify-content-center ">
  <div class="spinner-border " role="status">
    <span class="sr-only">Loading...</span>
  </div>
</div>
</div>


@section Scripts{


    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

     @foreach (var schedule in @Model.MasterSchedulesStandardViewModel.MasterScheduleStandardViewModels)
     {
         <script>
          $('#_@schedule.MasterScheduleStandardId').on('change', 'input', function() {
                 $('#spin').removeClass("d-none");
               $('#spin').addClass("d-flex");
               
               $('#_@schedule.MasterScheduleStandardId').submit();
                });
          
         </script>
     }
    
    
    
   
      
    <script>
    
    /*
    $(document).ready(function() {
       var table = $('#example').DataTable( {
           "processing": true,
           
           
           "serverSide": false,
               "ajax": {
                               "url": "AllSchedules?handler=test",
                               "type": "GET",
                               "datatype": "application/json",
                               "dataSrc": "masterScheduleStandardViewModels",
                               
                           },
                           
               "columns": [
                   {
                                        "className": 'details-control',
                                        "orderable": false,
                                        "data": null,
                                        "defaultContent": '',
                                        "render": function () {
                                            return '<i class="fas fa-caret-down" aria-hidden="true"></i>';
                                        },
                                        width:"15px"
                                    },
                   
                   { "data": "name" },
                   {
                           "data": "isActive",
                           render: function(data) {
                               console.log(data);
                             if (data === true) {
                                 console.log(data);
                               return '<input type="checkbox" class="form-control" checked>';
                             } else {
                                 console.log(data);
                               return '<input type="checkbox" class="form-control" ">';
                             }
                             console.log(data)
                      }
                      
                   }
                        
                   
                  
               ]
           } );
       
      
            
    // Add event listener for opening and closing details
         $('#example tbody').on('click', 'td.details-control', function () {
             var tr = $(this).closest('tr');
             var tdi = tr.find("i.fa");
             var row = table.row(tr);

             if (row.child.isShown()) {
                 // This row is already open - close it
                 row.child.hide();
                 tr.removeClass('shown');
                 tdi.first().removeClass('fa-minus-square');
                 tdi.first().addClass('fas fa-caret-down');
             }
             else {
                 // Open this row
                 row.child(format(row.data())).show();
                 $(row.child()).addClass('smalltable');
                 tr.addClass('shown');
                 tdi.first().removeClass('fas fa-caret-down');
                 tdi.first().addClass('fa-minus-square');
             }
         });

         table.on("user-select", function (e, dt, type, cell, originalEvent) {
             if ($(cell.node()).hasClass("details-control")) {
                 e.preventDefault();
             }
         });
         
    } );
    

    
    function format(d){
        
        var el = "";
        var i = 1;
        console.log(i++);
            for (var i = 0; i < d.intervals.length;i++) {
                
              el += '<table cellpadding="5" class="table table-hover table-sm table-borderless" cellspacing="0" border="0" style=" width: 100%; padding-left:50px;">' +
                                     '<tr>' + 
                                         '<td>Full name:</td>' +  
                                         '<td>'  +  moment(d.intervals[i].startTime).format("HH:mm") + ' - ' + moment(d.intervals[i].endTime).format("HH:mm")  +  '</td>' +
                                     '</tr>' +
                                    
                                 '</table>';  
            }
             // `d` is the original data object for the row
             return el;
        }
    
 
*/
    </script>

}